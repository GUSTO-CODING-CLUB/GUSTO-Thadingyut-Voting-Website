<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GUSTO Thadingyut Voting</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Mystery+Quest&family=Noto+Sans+Myanmar&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="{{ url_for('serve_image', filename='favicon.png') }}" />

  <style>
    /* Professional Smooth Navigation Indicator */
    #nav-indicator{
      position:absolute; border-radius:.75rem; background:#015486;
      box-shadow:0 4px 12px rgba(1, 84, 134, 0.3);
      transition:all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      opacity:0; pointer-events:none;
      transform-origin: center;
    }
        /* Keep links above the pill */
        .nav-a{ 
            position:relative; 
            z-index:10; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .nav-a:hover {
            transform: translateY(-1px);
        }

        /* ✅ Desktop-only: active link becomes white */
        @media (min-width:768px){
        .nav-a.is-active, .nav-a.is-active * { color:#fff !important; }
        }
        /* ✅ Mobile: keep active link dark on white background */
        @media (max-width:767px){
        .nav-a.is-active, .nav-a.is-active * { color:#111827 !important; } /* Tailwind gray-900 */
        }

        /* Smoother top/bottom fade on the card itself */
        .card-fade{
        -webkit-mask-image: linear-gradient(to bottom,
            transparent 0, black 20px,
            black calc(100% - 20px), transparent 100%);
                mask-image: linear-gradient(to bottom,
            transparent 0, black 20px,
            black calc(100% - 20px), transparent 100%);
        }
        @media (min-width:768px){
        .card-fade{
            -webkit-mask-image: linear-gradient(to bottom,
            transparent 0, black 26px,
            black calc(100% - 26px), transparent 100%);
                    mask-image: linear-gradient(to bottom,
            transparent 0, black 26px,
            black calc(100% - 26px), transparent 100%);
        }
        }

        /* Optimized Diya glow animation */
        @keyframes diya-glow {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }
        .animate-diya-glow {
            animation: diya-glow 3s ease-in-out infinite;
            will-change: opacity, transform;
        }
    #nav-indicator { position:absolute; border-radius:.75rem; background:#015486; box-shadow:0 4px 12px rgba(1, 84, 134, 0.3); transition:all 0.6s cubic-bezier(0.4, 0, 0.2, 1); opacity:0; pointer-events:none; transform-origin: center; }
    .nav-a{ position:relative; z-index:10; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    .nav-a:hover { transform: translateY(-1px); }
    @keyframes diya-glow { 0%{filter:brightness(1) drop-shadow(0 0 0px #FFD700);} 40%{filter:brightness(1.3) drop-shadow(0 0 16px #FFD700);} 60%{filter:brightness(1.1) drop-shadow(0 0 8px #FFD700);} 100%{filter:brightness(1) drop-shadow(0 0 0px #FFD700);} }
    .animate-diya-glow { animation: diya-glow 2s infinite; }
    </style>
</head>
<body class="flex flex-col min-h-screen bg-white text-gray-800">

<!-- Navbar -->
<nav class="bg-white shadow sticky top-0 z-50">
  <div class="flex items-center justify-between px-6 h-[72px]"> <!-- fixed height -->
    
    <!-- Logo -->
    <div class="flex items-center space-x-2">
      <a href="{{ url_for('home') }}" class="flex items-center">
        <img src="img/Gusto_Nav_Logo.png"
            alt="GUSTO Logo"
            class="h-[70px] w-auto -my-4 rounded-full" /> <!-- logo bigger, negative margin -->
      </a>
          <div class="flex flex-col md:flex-row items-center">
          <!-- GUSTO -->
          <span class="font-extrabold lg:text-3xl font-[Merriweather,serif]">
              GUSTO
          </span>

          <!-- Myanmar text -->
          <span
              class="ml-1 font-normal font-[Noto_Sans_Myanmar] whitespace-nowrap
                  text-base md:text-xl max-[330px]:text-sm">
              သီတင်းကျွတ်ပွဲတော်
          </span>
          </div>

    </div>

    <!-- Hamburger -->
    <button id="menu-btn" class="block md:hidden text-2xl p-2" aria-label="Open menu">&#9776;</button>

    <!-- Links -->
    <div id="nav-links"
        class="hidden md:flex flex-col md:flex-row items-start md:items-center
                space-y-2 md:space-y-0 md:space-x-4 bg-white px-4 py-4 md:p-0
                rounded-none md:rounded-full fixed md:static top-[64px] left-0
                w-full md:w-auto z-40 shadow md:shadow-none">

      <div class="relative md:flex md:items-center">
        <!-- Moving pill -->
        <span id="nav-indicator" aria-hidden="true"
              class="hidden md:block absolute top-0 left-0 rounded-xl bg-[#015486] shadow-lg"></span>

        <ul class="flex flex-col md:flex-row w-full md:w-auto space-y-2 md:space-y-0 md:space-x-2 font-medium">
          <li><a href="{{ url_for('home') }}"           class="nav-a block px-3 py-2 rounded-lg text-gray-700 lg:text-2xl">Home</a></li>
          <li><a href="{{ url_for('candidates') }}" class="nav-a block px-3 py-2 rounded-lg text-gray-700 lg:text-2xl">Candidate</a></li>
          <li><a href="{{ url_for('lantern') }}"        class="nav-a block px-3 py-2 rounded-lg text-gray-700 lg:text-2xl">Lantern</a></li>
          <li><a href="{{ url_for('mote_phoe') }}"      class="nav-a block px-3 py-2 rounded-lg text-gray-700 lg:text-2xl">Mote Phoe</a></li>
          <li><a href="{{ url_for('results') }}"  class="nav-a block px-3 py-2 rounded-lg text-gray-700 lg:text-2xl">Voting Result</a></li>
          <li><a href="{{ url_for('about') }}"       class="nav-a block px-3 py-2 rounded-lg text-gray-700 lg:text-2xl">About Us</a></li>
          <li><a href="{{ url_for('final') }}"          class="nav-a block px-3 py-2 rounded-lg text-gray-700 lg:text-2xl">Final</a></li>
          <li><a href="{{ url_for('winner') }}"         class="nav-a block px-3 py-2 rounded-lg text-gray-700 lg:text-2xl">Winner</a></li>
          <li><a href="{{ url_for('logout') }}"         class="nav-a block px-3 py-2 rounded-lg text-gray-700 lg:text-2xl">Logout</a></li>
        </ul>
      </div>
    </div>
  </div>
</nav>

<!-- Main Content -->
<div class="main flex justify-center items-center px-6 py-10 relative">
  <div class="max-w-7xl w-full space-y-8">
    {% for lantern in lanterns %}
    <div class="bg-white rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-500 transform hover:-translate-y-2 overflow-hidden border border-gray-100">
      <!-- Lantern Header -->
      <div class="bg-gradient-to-r from-orange-500 to-orange-600 px-6 py-4">
        <h1 class="text-3xl md:text-4xl font-mystery text-white text-center font-bold tracking-wide">
          Lantern No {{ loop.index }}
        </h1>
      </div>

      <!-- Lantern Content -->
      <div class="p-6 md:p-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8 items-center">
          <div class="text-center lg:text-left space-y-3">
            <h2 class="text-2xl md:text-3xl font-myanmar font-bold text-gray-800 leading-tight">{{ lantern.name }}</h2>
            <div class="inline-flex items-center px-4 py-2 bg-orange-100 rounded-full">
              <span class="text-orange-700 font-myanmar font-semibold text-sm md:text-base">{{ lantern.batch }}</span>
            </div>
          </div>

          <div class="flex justify-center">
            <div class="relative group">
              <div class="relative w-[280px] h-[350px] md:w-[320px] md:h-[400px] overflow-hidden shadow-2xl rounded-t-full transform transition-all duration-500 group-hover:scale-105">
                <img src="{{ url_for('serve_lantern_images', filename=lantern.image_path.split('/')[-1]) }}" alt="Lantern {{ loop.index }}" class="w-full h-full object-contain transition-transform duration-500 group-hover:scale-110" />
                <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
              </div>
              <div class="absolute inset-0 rounded-t-full bg-orange-400/20 blur-xl scale-110 opacity-0 group-hover:opacity-100 transition-opacity duration-500 -z-10"></div>
            </div>
          </div>

          <div class="text-center lg:text-left space-y-6">
            <p class="text-gray-700 leading-relaxed font-myanmar text-base md:text-lg">{{ lantern.description }}</p>
            <div class="flex justify-center lg:justify-start">
              <button onclick="openTokenModal({{ lantern.id }})" class="group relative px-8 py-4 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-xl font-myanmar font-bold text-lg shadow-lg hover:shadow-xl transform transition-all duration-300 hover:scale-105 hover:from-orange-600 hover:to-orange-700 focus:outline-none focus:ring-4 focus:ring-orange-300">
                <span class="relative z-10">Vote Now</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<!-- Token Modal -->
<div id="token-modal" class="fixed inset-0 z-[60] hidden">
  <div class="absolute inset-0 bg-black/60" onclick="closeTokenModal()"></div>
  <div class="relative mx-auto my-8 w-[92%] max-w-[560px]">
    <div class="relative rounded-2xl overflow-hidden shadow-2xl">
      <div class="relative w-full" style="--modal-h: 520px;">
        <div class="relative w-full" style="height: var(--modal-h);">
          <img src="{{ url_for('serve_image', filename='token.png') }}" alt="Token" class="absolute inset-0 w-full h-full object-contain bg-transparent" />
          <div class="absolute inset-0 pointer-events-none bg-[radial-gradient(circle_at_center,rgba(0,0,0,0)_0%,rgba(0,0,0,0)_60%,rgba(0,0,0,0.25)_100%)]"></div>
          <div class="absolute left-1/2 top-[58%] -translate-x-1/2 -translate-y-1/2 w-[78%] max-w-xs">
            <div class="backdrop-blur-[2px] bg-white/40 rounded-lg shadow p-2">
              <input id="token-text" maxlength="6" autocomplete="off" inputmode="latin" pattern="[A-Za-z0-9]{6}" class="w-full text-center tracking-widest uppercase rounded-md border border-white/60 focus:ring-2 focus:ring-orange-500 focus:border-orange-500 px-3 py-2 font-mono text-base bg-transparent placeholder-white/70 text-gray-900" placeholder="TOKEN" />
            </div>
            <p id="token-error" class="hidden text-red-600 text-sm mt-2 text-center">Enter 6 characters.</p>
            <div class="mt-3 flex items-center justify-center gap-2">
              <button type="button" onclick="submitToken()" class="min-w-[96px] px-4 py-2.5 rounded-md bg-gradient-to-r from-orange-500 to-orange-600 text-white font-semibold shadow hover:from-orange-600 hover:to-orange-700">OK</button>
              <button type="button" onclick="closeTokenModal()" class="min-w-[96px] px-4 py-2.5 rounded-md border border-white/70 text-white bg-black/20 hover:bg-black/30">Cancel</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Footer -->
<footer class="bg-[#03254C] py-4 px-4 md:py-5 md:px-8 h-auto md:h-[200px]">
  <div class="flex flex-col md:flex-row justify-between items-center h-full text-center">

      <div class="text-orange-400 font-medium 
                  text-base lg:text-xl 
                  mb-3 md:mb-0 
                  ml-0 md:ml-[100px] 
                  pr-0 md:pr-4 order-1">
      ပျော်ရွှင်စရာသတင်းကျွတ်အချိန်အခါလေးဖြစ်ပါစေ
      </div>

      <div class="flex justify-center items-center py-2 order-2 flex-grow-0">
      <img src="img/SeMeeKut.png" alt="Diya" class="w-[36px] h-[36px] mx-1 md:w-[50px] md:h-[50px] animate-diya-glow" />
      <img src="img/SeMeeKut.png" alt="Diya" class="w-[50px] h-[50px] -mt-3 mx-1 md:w-[70px] md:h-[70px] md:-mt-4 animate-diya-glow" />
      <img src="img/SeMeeKut.png" alt="Diya" class="w-[36px] h-[36px] mx-1 md:w-[50px] md:h-[50px] animate-diya-glow" />
      </div>

      <div class="flex flex-col items-center md:items-end 
                  text-orange-400 font-medium 
                  text-base md:text-lg lg:text-xl 
                  mt-3 md:mt-0 
                  mr-0 md:mr-[100px] 
                  pl-0 md:pl-4 order-3">
      
      <div class="flex flex-wrap justify-center md:justify-end w-[370px] lg:justify-center space-x-4 md:space-x-6 mb-1 md:mb-0 font-[fa-chevron-left]">
          <a href="{{ url_for('home') }}" class="hover:text-yellow-400">Home</a>
          <a href="{{ url_for('candidates') }}" class="hover:text-yellow-400">Candidate</a>
          <a href="{{ url_for('lantern') }}" class="hover:text-yellow-400">Lantern</a>
      </div>

      <br>

      <div class="flex flex-wrap justify-center md:justify-end space-x-4 md:space-x-6 mt-1 md:mt-1 font-[fa-chevron-left]">
          <a href="{{ url_for('results') }}" class="hover:text-yellow-400">Voting Result</a>
          <a href="{{ url_for('about') }}" class="hover:text-yellow-400">About us</a>
          <a href="{{ url_for('final') }}" class="hover:text-yellow-400">Final</a>
          <a href="{{ url_for('winner') }}" class="hover:text-yellow-400">Winner</a>
      </div>
      </div>

  </div>
</footer>

<!-- Scripts -->
<script>
tailwind.config = { theme: { extend: { fontFamily: { mystery: ['"Mystery Quest"', 'cursive'], myanmar: ['"Myanmar Sans Pro"', '"Noto Sans Myanmar"', 'sans-serif'], }, }, }, }

const menuBtn = document.getElementById('menu-btn');
const navLinks = document.getElementById('nav-links');
if (menuBtn && navLinks) menuBtn.addEventListener('click', () => navLinks.classList.toggle('hidden'));

// Lantern voting modal
let selectedLanternId = null;
function openTokenModal(lanternId){
  selectedLanternId = lanternId;
  const modal = document.getElementById('token-modal');
  const input = document.getElementById('token-text');
  const error = document.getElementById('token-error');
  if(modal){
    modal.classList.remove('hidden');
    input.value = '';
    error.classList.add('hidden');
    setTimeout(() => input.focus(), 50);
  }
}
function closeTokenModal(){
  const modal = document.getElementById('token-modal');
  if(modal){ modal.classList.add('hidden'); }
}

function submitToken(){
  const input = document.getElementById('token-text');
  const error = document.getElementById('token-error');
  let token = (input?.value || '').trim().toUpperCase();

  if(token.length !== 6){
    error.classList.remove('hidden');
    return;
  }

  const okBtn = event?.target || document.querySelector("#token-modal button");
  if(okBtn){ okBtn.disabled = true; okBtn.classList.add('opacity-70'); }

  fetch('/final_vote', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      token: token,
      category: "lantern",
      candidate_id: selectedLanternId
    })
  })
   .then(res => res.json())
   .then(data => {
     showToast(data.message, data.success ? 'success' : 'error');
     // Stay on this page even after success
   })
  .catch(err => {
    console.error(err);
    showToast('Something went wrong. Please try again.', 'error');
  })
  .finally(() => {
    if(okBtn){ okBtn.disabled = false; okBtn.classList.remove('opacity-70'); }
    closeTokenModal();
  });
}

 // Toast system (centered)
 const toastRootId = 'toast-root';
 function ensureToastRoot(){
   let root = document.getElementById(toastRootId);
   if(!root){
     root = document.createElement('div');
     root.id = toastRootId;
     root.className = 'fixed inset-0 z-[70] pointer-events-none flex items-center justify-center';
     document.body.appendChild(root);
   }
   return root;
 }
 function showToast(message, type){
   const root = ensureToastRoot();
   const el = document.createElement('div');
   el.className = `pointer-events-auto px-5 py-4 rounded-xl shadow-2xl text-white text-base md:text-lg ${type==='success'?'bg-green-600/95':'bg-red-600/95'} backdrop-blur-sm animate-[fadeIn_.2s_ease-out]`;
   el.textContent = message || (type==='success'?'Done.':'Something went wrong.');
   root.appendChild(el);
   setTimeout(() => {
     el.classList.add('opacity-0');
     el.classList.add('transition-opacity');
     el.classList.add('duration-300');
     setTimeout(()=> el.remove(), 320);
   }, 1800);
 }
</script>
<script src="{{ url_for('static', filename='js/navigation.js') }}"></script>
</body>
</html>
